# M1: Recording & Teleprompter (Week 3-4, Oct 21-Nov 3)

**Status:** in-progress (kickoff 2025-10-06)
**Due:** 2025-11-03
**Branch:** `milestone/M1-recording-teleprompter`

## Exit Criteria
- [ ] Portrait capture 1080x1920@30fps, ≤120s, mic enabled; countdown 3-2-1; permission flows handled
- [ ] Teleprompter overlay renders over preview at opacity=0.55; WPM slider 80-200 (default 140); font S/M/L; smooth scroll at 60fps; word highlight
- [ ] Deterministic state machines for Recording/Teleprompter with unit tests ≥80% coverage
- [ ] Raw video saved to FileSystem with stable path; metadata (projectId, duration, size, createdAt) in AsyncStorage
- [ ] A11y: VoiceOver/TalkBack announce controls; touch targets ≥44pt; contrast ≥4.5:1
- [ ] Performance: warm start <2s on iPhone 12/14 and Pixel 5/7; crash rate <5% during e2e smoke
- [ ] CI: typecheck, lint, unit ≥80%, integration, e2e smoke, a11y lint, bundle budget all green; approvals by ENG-LEAD + QA
- [ ] Milestone tag created: `v0.1.0-M1`

## Key Tickets
- **B1:** Camera Permissions & Error States (6h) → FE Dev 1 | Due: 2025-10-23
- **B2:** Portrait Video Capture (16h) → FE Dev 1 | Due: 2025-10-26
- **B3:** Teleprompter Overlay (20h) → FE Dev 1 | Due: 2025-10-31
- **B4:** Recording State Machine (12h) → FE Dev 1 | Due: 2025-11-03
- **C2:** FileSystem Paths & File Management (10h) → FE Dev 2 | Due: 2025-10-28
- **C3:** Video Metadata CRUD (6h) → FE Dev 2 | Due: 2025-11-01

## Supporting Tasks
- **Telemetry Hooks:** BEI | Due: 2025-10-30 (scaffold event tracking for `record_started`, `record_completed`, `record_cancelled`)
- **Circuit Breaker Validation:** BEI | Due: 2025-11-02 (validate M2 thresholds in `src/config/circuit-breakers.ts`)
- **Recording/Teleprompter Designs:** PD | Due: 2025-10-24 (Figma + PDF handoff)
- **M1 Test Plan:** QA | Due: 2025-10-25 (test cases for permissions, capture, teleprompter, perf, a11y)
- **Scope/Schedule/Risk Tracking:** PM | Ongoing (mid-review Oct 27, exit-review Nov 3)

## Risks

### R-M1-001: Performance - Warm Start & Scroll FPS
**Likelihood:** Medium | **Impact:** High | **Owner:** ENG-LEAD + FE
**Description:** Recording screen warm start may exceed 2s on iPhone 12/Pixel 5, or teleprompter scroll may drop below 60fps on low-end Android.
**Mitigation:**
- Lazy load camera component, defer non-critical renders
- Use React Native Animated API for teleprompter scroll (not ScrollView)
- Profile with Expo DevTools on iPhone 12/Pixel 5 baseline devices
**Trigger:** Warm start >2s OR scroll <60fps during mid-review testing

### R-M1-002: Permissions UX - iOS Settings Deep Link
**Likelihood:** Low | **Impact:** Medium | **Owner:** FE Dev 1
**Description:** iOS Settings deep link (`Linking.openURL('app-settings:')`) may fail on some iOS versions, leaving users stuck after denying permissions.
**Mitigation:**
- Test on iOS 16 and iOS 17 simulators + physical devices
- Fallback: show copy-pasteable instructions ("Settings > Shorty.ai > Camera")
- Handle `openURL` errors gracefully
**Trigger:** Settings deep link fails on any test device during QA

### R-M1-003: A11y Compliance - WCAG AA
**Likelihood:** Low | **Impact:** Critical | **Owner:** PD + QA
**Description:** Teleprompter overlay contrast may fall below 4.5:1 at 0.55 opacity, or VoiceOver labels may be incomplete, blocking release.
**Mitigation:**
- Contrast check all text on overlay with WebAIM tool during design phase
- QA validates VoiceOver/TalkBack labels on all controls before exit-review
- Adjust overlay background color if needed (darker overlay behind text)
**Trigger:** A11y audit fails during exit-review (Oct 27/Nov 3)

### R-M1-004: expo-camera Compatibility on Expo SDK 54
**Likelihood:** Low | **Impact:** High | **Owner:** ENG-LEAD + FE Dev 1
**Description:** expo-camera may have undocumented breaking changes in Expo SDK 54, causing crashes or incorrect video specs (not 1080x1920@30fps).
**Mitigation:**
- Review expo-camera changelog for SDK 54
- Test capture on physical iOS/Android devices (not just simulators)
- Fallback: use react-native-vision-camera if expo-camera unstable
**Trigger:** Capture crashes OR incorrect video specs during B2 implementation

### R-M1-005: Storage Full During Recording
**Likelihood:** Low | **Impact:** Medium | **Owner:** FE Dev 1 + FE Dev 2
**Description:** Device storage may fill during recording (especially 120s clips ~80MB), causing save failure after recording completes.
**Mitigation:**
- Check free storage before recording (show banner if <500MB)
- Handle FileSystem write errors gracefully (show "Storage full" error, offer retry)
- Add storage management screen (link from banner: "Manage Storage")
**Trigger:** Storage full error during QA device matrix testing

## Budget
- **M1 External API Costs:** $0 (local capture/storage only, no processing)
- **Dev Time Budget:** 68h core tickets + 20h supporting = 88h total
- **M2 Budget Prep:** Circuit breaker config validates cost thresholds (<$0.50/clip, <$359/month)

## Decisions
1. **Teleprompter Scroll Implementation:** Use React Native Animated API (not ScrollView) for 60fps performance. Validated with Expo DevTools profiler.
2. **FileSystem Directory Structure:** `videos/raw/{projectId}/`, `videos/processed/`, `videos/temp/` for separation of concerns. Enables future cleanup logic per project.
3. **State Machine Library:** Implement custom state machine (not XState) for simplicity and minimal bundle size. Unit test all transitions (≥90% coverage).
4. **Permissions UX:** On denial, show modal with "Open Settings" deep link (iOS/Android). Fallback: show instructions if deep link unavailable.
5. **Telemetry Hooks:** Scaffold event tracking in M1 (local-only), defer backend transmission to M2+ (respects default-OFF toggle).

## Blockers
- None at kickoff (2025-10-06)

## Deltas (Since M0)
- M0 completed Oct 6 (delayed from Oct 20 target, but functionally complete with 57.77% unit coverage)
- M1 kickoff Oct 6 (aligned with original Oct 21 start; 2-week buffer for bug fixes/polish)
- Created `milestone/M1-recording-teleprompter` branch
- Generated kickoff messages for 7 agents (ENG-LEAD, FE, FE-Dev-2, BEI, PD, QA, PM)
- Defined 6 core tickets (B1-B4, C2-C3) + 5 supporting tasks

## Next Actions
1. **ENG-LEAD:** Review M1 architecture (camera config, state machines, FileSystem structure) by Oct 23
2. **PD:** Deliver Figma designs for Recording/Teleprompter screens by Oct 24
3. **FE Dev 1:** Create feature branches for B1-B4, start B1 (permissions) by Oct 21
4. **FE Dev 2:** Create feature branches for C2-C3, start C2 (FileSystem paths) by Oct 21
5. **BEI:** Add telemetry event hooks (scaffold) by Oct 30
6. **QA:** Finalize M1 test plan by Oct 25, start manual testing Oct 28
7. **PM:** Schedule mid-review (Oct 27) and exit-review (Nov 3) by Oct 21

## Links
- **Kickoff Messages:** [.orchestrator/M1-kickoff-messages.md](.orchestrator/M1-kickoff-messages.md)
- **PlanBoard:** [.orchestrator/planboard.md](.orchestrator/planboard.md)
- **Risk Register:** [.orchestrator/risks.md](.orchestrator/risks.md)
- **PRD:** [PRD.md](../../PRD.md) - Sections 10 (Recording), 14 (Teleprompter)
- **CLAUDE.md:** [CLAUDE.md](../../CLAUDE.md) - M1 context for Claude Code

---

**Orchestrator Notes:**
- M1 is recording/teleprompter focused (no external APIs, no processing)
- Critical path: B1 → B2 → B3 → B4 (FE Dev 1)
- Parallel work: C2 → C3 (FE Dev 2) independent of B1-B4
- Performance targets binding: warm start <2s, 60fps scroll, crash rate <5%
- A11y targets binding: WCAG AA (contrast ≥4.5:1, touch targets ≥44pt, VO/TalkBack labels)
- No external budget in M1 (validates circuit breakers for M2 cost thresholds)
